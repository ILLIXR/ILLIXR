
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://illixr.github.io/testing/latest/writing_your_plugin/">
      
      
        <link rel="prev" href="../modifying_a_plugin/">
      
      
        <link rel="next" href="../monado_illixr_runtime_overview/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.7">
    
    
      
        <title>Writing your Plugin (Version 2) - ILLIXR Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#writing-your-plugin" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ILLIXR Documentation" class="md-header__button md-logo" aria-label="ILLIXR Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ILLIXR Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Writing your Plugin (Version 2)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ILLIXR Documentation" class="md-nav__button md-logo" aria-label="ILLIXR Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    ILLIXR Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href=".." class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Latest Documentation
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Latest Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started (Version 2)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../building_illixr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Building ILLIXR (Version 2)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debugging_illixr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ILLIXR Debugging Tips (Version 2)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../virtualization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ILLIXR under Virtualization (Version 2)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../illixr_plugins/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ILLIXR Plugins (Version 2)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modifying_a_plugin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modifying a Plugin (Version 2)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Writing your Plugin (Version 2)
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Writing your Plugin (Version 2)
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#adding-a-new-plugin-common-case" class="md-nav__link">
    <span class="md-ellipsis">
      Adding a New Plugin (Common Case)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-a-new-plugin-general-case" class="md-nav__link">
    <span class="md-ellipsis">
      Adding a New Plugin (General Case)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tutorial" class="md-nav__link">
    <span class="md-ellipsis">
      Tutorial
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../monado_illixr_runtime_overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monado Overview (Version 2)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../monado_integration_dataflow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monado Dataflow (Version 2)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../logging_and_metrics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logging and Metrics (Version 2)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../glossary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ILLIXR Glossary (Version 2)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/annotated/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ILLIXR API (Version 2)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../LICENSE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ILLIXR License (Version 2)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CONTRIBUTING/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing Guidelines (Version 2)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../legacy/v1/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Legacy Documentation
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Legacy Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../legacy/v1/README-audio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Audio Pipeline (Version 1)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../legacy/v1/README-efusion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ElasticFusion (Version 1)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../legacy/v1/README-hotlab/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HOTlab (Version 1)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../legacy/v1/README-openvins/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenVINS (Version 1)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../legacy/v1/README-ritnet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RITnet (Version 1)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../legacy/v1/README-visualpp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visual Post-processing (Version 1)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="writing-your-plugin">Writing Your Plugin</h1>
<h2 id="adding-a-new-plugin-common-case">Adding a New Plugin (Common Case)</h2>
<p>In the common case, you only need to define a <code>Makefile</code> with the line <code>include common/common.mk</code>
    and symlink common (<code>ln -s ../common common</code>).
The included recipe file provides the necessary targets and uses the compiler <code>$(CXX)</code>,
    which is defined based on the OS and environment variables.
The included <code>Makefile</code>:</p>
<ul>
<li>
<p>Compiles <code>plugin.cpp</code> and any other <code>*.cpp</code> files into the plugin.</p>
</li>
<li>
<p>Will invoke a recompile of the target any time any <code>*.hpp</code> or <code>*.cpp</code> file changes.</p>
</li>
<li>
<p>Compiles with C++17.
    You can change this in your plugin by defining
        <code>STDCXX = ...</code> before the <code>include</code>.
    This change will not affect other plugins; just yours.</p>
</li>
<li>
<p>Accepts specifying libraries by appending to <code>LDFLAGS</code> and <code>CFLAGS</code>.
    For example:</p>
<!--- language: lang-makefile -->
<div class="language-text highlight"><pre><span></span><code>LDFLAGS := $(LDFLAGS) $(shell pkg-config --ldflags eigen3)
CFLAGS  := $(CFLAGS) $(shell pkg-config --cflags eigen3)
</code></pre></div>
<p>See the source for the other flags and variables that you can set.</p>
</li>
</ul>
<p>Finally, place the path of your plugin directory in the <code>plugin_group</code> list
    for the configuration you would like to run (e.g. <code>ILLIXR/configs/native.yaml</code>).</p>
<h2 id="adding-a-new-plugin-general-case">Adding a New Plugin (General Case)</h2>
<p>Each plugin can have a completely independent build system, as long as:</p>
<ul>
<li>
<p>It defines a <code>Makefile</code> with targets for <code>plugin.dbg.so</code>, <code>plugin.opt.so</code>, and <code>clean</code>.
    Inside this <code>Makefile</code>, one can defer to another build system.</p>
</li>
<li>
<p>Its compiler maintains <em>ABI compatibility</em> with the compilers used in every other plugin.
    Using the same version of Clang or GCC on the same architecture is sufficient for this.</p>
</li>
<li>
<p>Its path is in the <code>plugin_group</code> list for the configuration you would like
        to run (e.g. <code>ILLIXR/configs/native.yaml</code>).</p>
</li>
</ul>
<h2 id="tutorial">Tutorial</h2>
<p>You can extend ILLIXR for your own purposes.
To add your own functionality via the plugin interface:</p>
<ol>
<li>
<p>Create a new directory anywhere for your new plugin and set it up for ILLIXR.
    We recommend you also push this plugin to a git repository on Github/Gitlab if you want it
        as a part of upstream ILLIXR in the future.</p>
<ul>
<li>
<p>Create a <code>Makefile</code> with the following contents.
    See <a href="../building_illixr/">Building ILLIXR</a> for more details and alternative setups.</p>
<!--- language: lang-makefile -->
<div class="language-text highlight"><pre><span></span><code>include common.mk
</code></pre></div>
</li>
</ul>
</li>
<li>
<p>You must decide if your plugin should inherit the standardized <a href="../api/classILLIXR_1_1threadloop/"><code>threadloop</code></a>
        or <a href="../api/classILLIXR_1_1plugin/"><code>plugin</code></a>.</p>
<ul>
<li>
<p>If your plugin just needs to run one computation repeatedly,
        then your plugin class should extend <a href="../api/classILLIXR_1_1threadloop/"><code>threadloop</code></a>.</p>
</li>
<li>
<p>If you need custom concurrency (more complicated than a loop),
        triggered concurrency (by events fired in other plugins),
        or no concurrency then your plugin class should extend <a href="../api/classILLIXR_1_1plugin/"><code>plugin</code></a>.</p>
<ul>
<li>
<p>If you spin your own threads, they <strong>must</strong> wait for
  <code>pb-&gt;lookup_impl&lt;Stoplight&gt;()-&gt;wait_for_ready()</code> the first time they
  run. This allows the start of all threads in ILLIXR to be
  synchronized.</p>
</li>
<li>
<p>They <strong>must</strong> be joined-or-disowned at-or-before
  <code>plugin::stop()</code>. This allows ILLIXR to shutdown cleanly.</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Write a file called <code>plugin.cpp</code> with this body, replacing every instance of <code>plugin_name</code>:</p>
<!--- language: lang-cpp -->
<div class="language-text highlight"><pre><span></span><code>#include &quot;common/phonebook.hpp&quot;
#include &quot;common/plugin.hpp&quot;
#include &quot;common/threadloop.hpp&quot;

using namespace ILLIXR;

/// Inherit from `plugin` if you don&#39;t need the threadloop
class plugin_name : public threadloop {
public:
    plugin_name(std::string name_, phonebook* pb_)
        : threadloop{name_, pb_}
        { }
    virtual void start() override { }
    virtual ~plugin_name() override { }
};

// This line makes the plugin importable by Spindle
PLUGIN_MAIN(plugin_name);
</code></pre></div>
</li>
<li>
<p>At this point, you should be able to build your plugin with ILLIXR.
    Move to the ILLIXR repo and update <code>configs/native.yaml</code>.
    If the new plugin is the same type as one of the other components you will need to
        remove that component from the config before running the new component.
    For example, if the new component is a SLAM then the old SLAM needs to be removed from
        the config.
    See <a href="../building_illixr/">Building ILLIXR</a> for more details on the config file.</p>
<!--- language: lang-yaml -->
<div class="language-text highlight"><pre><span></span><code>plugin_groups:
  - !include &quot;rt_slam_plugins.yaml&quot;
  - !include &quot;core_plugins.yaml&quot;
  - plugin_group:
     - path: /PATH/TO/NEW/PLUGIN
     - path: ground_truth_slam/
     - path: gldemo/
     - path: debugview/

data:
  subpath: mav0
  relative_to:
  archive_path:
  download_url: &#39;http://robotics.ethz.ch/~asl-datasets/ijrr_euroc_mav_dataset/vicon_room1/V1_02_medium/V1_02_medium.zip&#39;
  demo_data: demo_data/
  loader:
    name: native
    # command: gdb -q --args %a
    profile: opt
</code></pre></div>
</li>
<li>
<p>Finally, run ILLIXR with your new plugin with the following command:</p>
<!--- language: lang-shell -->
<div class="language-text highlight"><pre><span></span><code>./runner.sh configs/native.yaml
</code></pre></div>
</li>
<li>
<p>This is all that is required to be a plugin which can be loaded by Spindle in
        the ILLIXR runtime.
    Reading and writing from Phonebook and Switchboard is optional,
        but nearly every plugin does it.
    See <code>default_plugins.md</code> for more details.</p>
<p>First, we can query the <a href="../api/classILLIXR_1_1phonebook/"><code>phonebook</code></a> to get various services
    including <a href="../api/classILLIXR_1_1switchboard/"><code>switchboard</code></a>.
Then we query <a href="../api/classILLIXR_1_1switchboard/"><code>switchboard</code></a> for event-streams (topics).
We will read <code>topic1</code>, write to <code>topic2</code>, and schedule computation on <code>topic 3</code>.
See the API documentation for <code>phonebook</code> and <code>switchboard</code> for more details.</p>
<!--- language: lang-cpp -->
<div class="language-text highlight"><pre><span></span><code>#include &quot;common/phonebook.hpp&quot;
#include &quot;common/plugin.hpp&quot;
#include &quot;common/threadloop.hpp&quot;

/* When datatypes have to be common across plugins
 *     (e.g. a phonebook service or switchboard topic),
 *      they are defined in this header,
 *      which is accessible to all plugins.
 */
#include &quot;common/data_format.hpp&quot;

class plugin_name : public threadloop {
public:
    /* After the constructor, C++ permits a list of member-constructors.
     * We use uniform initialization (curly-braces) [1] instead of parens to
     *     avoid ambiguity [2].
     * We put the comma at the start of the line, so that lines can be copied around
     *     or deleted freely (except for the first).
     *
     * [1]: https://en.wikipedia.org/wiki/C%2B%2B11#Uniform_initialization
     * [2]: https://en.wikipedia.org/wiki/Most_vexing_parse
     */
    plugin_name(std::string name_, phonebook* pb_)
        : threadloop{name_, pb_}
          /// Find the switchboard in phonebook
        , sb{pb-&gt;lookup_impl&lt;switchboard&gt;()}
          /// Create a handle to a topic in switchboard for subscribing
        , topic1{sb-&gt;get_reader&lt;topic1_type&gt;(&quot;topic1&quot;)}
          /// Create a handle to a topic in switchboard for publishing
        , topic2{sb-&gt;get_writer&lt;topic2_type&gt;(&quot;topic2&quot;)}
    {
        /// Read topic 1
        switchboard::ptr&lt;const topic1_type&gt; event1 = topic1.get_ro();

        /// Write to topic 2
        topic2.put(
            topic2.allocate&lt;topic2_type&gt;(
                arg_1, // topic2_type::topic2_type() arg_type_1
                ...,   // ...
                arg_k  // topic2_type::topic2_type() arg_type_k
            )
        );

        /// Read topic 3 synchronously
        sb-&gt;schedule&lt;topic3_type&gt;(
            get_name(),
            &quot;topic3&quot;,
            [&amp;](switchboard::ptr&lt;const topic3_type&gt; event3, std::size_t) {
                /* This is a [lambda expression][1]
                 *
                 * [1]: https://en.cppreference.com/w/cpp/language/lambda
                 */
                std::cout &lt;&lt; &quot;Got a new event on topic3: &quot; &lt;&lt; event3 &lt;&lt; std::endl;
                callback(event3);
            }
        );
    }

    virtual void _p_one_iteration override() {
        std::cout &lt;&lt; &quot;Running&quot; &lt;&lt; std::endl;
        auto target = std::chrono::system_clock::now()
                    + std::chrono::milliseconds{10};
        reliable_sleep(target);
    }

private:
    const std::shared_ptr&lt;switchboard&gt; sb;
    switchboard::reader&lt;topic1_type&gt; topic1;
    switchboard::writer&lt;topic2&gt; topic2;
};

/// This line makes the plugin importable by Spindle
PLUGIN_MAIN(plugin_name);
</code></pre></div>
</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["search.suggest", "content.code.annotate", "content.footnote.tooltips", "navigation.indexes", "toc.integrate"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>