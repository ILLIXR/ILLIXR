<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://illixr.github.io/ILLIXR/docs/plugin_README/monado_illixr_runtime_overview/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Monado Overview - ILLIXR Docs</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../../css/code-box-copy.css" rel="stylesheet" />
        <link href="../../css/prism.min.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Monado Overview";
        var mkdocs_page_input_path = "plugin_README/monado_illixr_runtime_overview.md";
        var mkdocs_page_url = "/ILLIXR/docs/plugin_README/monado_illixr_runtime_overview/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> ILLIXR Docs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Latest Documentation</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../..">ILLIXR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../getting_started/">Getting Started</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../using_cameras/">Using ILLIXR with Cameras</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../debugging_illixr/">ILLIXR Debugging Tips</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../virtualization/">ILLIXR Under Virtualization</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../illixr_plugins/">ILLIXR Plugin Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../modifying_a_plugin/">Modifying a Plugin</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../writing_your_plugin/">Writing Your Plugin</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Plugin Details</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../README_debugview/">Debugview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../README_display_vk/">Display_VK</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../README_fauxpose/">Fauxpose</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../README_gldemo/">Gldemo</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="./">Monado Overview</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#openxr-application-launch">OpenXR Application Launch</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#monado-device-probe-and-illixr-initialization">Monado Device Probe and ILLIXR Initialization</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#illixr-runtime-launch">ILLIXR Runtime Launch</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#translation-plugin">Translation Plugin</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../monado_integration_dataflow/">Monado Dataflow</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../README_native_renderer/">Native Renderer</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../offload_vio/">Offload VIO</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../README_openni/">OpenNI</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../README_record_imu_cam/">Record_imu_cam</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../README_timewarp_gl/">Timewarp_gl</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../README_timewarp_vk/">Timewarp_VK</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../README_vkdemo/">Vkdemo</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../README_zed/">Zed</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../logging_and_metrics/">Logging and Metrics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../glossary/">ILLIXR Glossary</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/html/annotated.html">ILLIXR API</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../LICENSE/">ILLIXR License</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../CONTRIBUTING/">Contributing Guidelines</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../updating_tags_and_docs/">Updating Tags and Documentation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../external_switchboard_and_phonebook/">Using Switchboard and Phonebook Externally</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">ILLIXR Docs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
          <li>Latest Documentation &raquo;</li>
          <li>Plugin Details &raquo;</li>
      <li>Monado Overview</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="monado-integration-overview">Monado Integration Overview</h1>
<p>ILLIXR's <a href="../../glossary/#plugin"><em>Plugins</em></a> provide XR services, and the <a href="../../glossary/#runtime"><em>Runtime</em></a> ties them together.
However, we don't want to force developers to write <em>their whole application</em> specifically
    for ILLIXR.
As such, we want to implement a common interface XR runtimes, such as <a href="../../glossary/#openxr">OpenXR</a>,
    so one application can work on several runtimes (including ours).
In order to support OpenXR, we modified <a href="../../glossary/#monado">Monado</a>, an existing, open-source implementation
    of the standard.</p>
<ul>
<li>
<p>When running ILLIXR without Monado, the ILLIXR runtime is the entry-point.
    Phonebook and switchboard are initialized and plugins are loaded, among which is the gldemo app.</p>
</li>
<li>
<p>When running from Monado, however, as mandated by OpenXR specifications,
        the application is the entry point.
    As a result, the ILLIXR runtime system is loaded at a later point as a shared library.
    This page documents the changes to the ILLIXR runtime when an OpenXR application is used.</p>
</li>
</ul>
<h2 id="openxr-application-launch">OpenXR Application Launch</h2>
<p>As specified by <a href="../../glossary/#openxr"><em>OpenXR</em></a>, the OpenXR application initializes the OpenXR runtime by reading a
    configuration JSON file pointed to by an environment variable and loads the OpenXR runtime,
    which is Monado in this case, as a shared library into its address space.
Consult the OpenXR specifications and the OpenXR-SDK from Khronos Group for more details.</p>
<h2 id="monado-device-probe-and-illixr-initialization">Monado Device Probe and ILLIXR Initialization</h2>
<p>During initialization, <a href="../../glossary/#monado"><em>Monado</em></a> asks all drivers to probe for and initialize <a href="../../glossary/#head-mounted-display"><em>HMDs</em></a>
    and controllers, internally known as <code>xdev</code>s.
Our ILLIXR driver will always respond to Monado with one discovered HMD that
    will be used to capture OpenXR queries and events from Monado's state tracker.
The driver obtains the path to the ILLIXR runtime <code>.so</code> file and a list of plugins from
    environment variables.</p>
<p>After probing is finished, the application will start to create an OpenXR session.
At some point in this process, the application will send its rendering context to the runtime,
    which we capture and send to the ILLIXR driver.
At this moment, all necessary data is ready and ILLIXR will be launched.</p>
<h2 id="illixr-runtime-launch">ILLIXR Runtime Launch</h2>
<p>When used with <a href="../../glossary/#monado"><em>Monado</em></a>, the ILLIXR <a href="../../glossary/#runtime"><em>Runtime</em></a> is compiled into
    a shared library instead of an executable.
The library exports its two major functionalities:
    initializing <a href="../../glossary/#switchboard"><em>Switchboard</em></a> and <a href="../../glossary/#phonebook"><em>Phonebook</em></a>,
    and
    loading <a href="../../glossary/#plugin"><em>Plugins</em></a>.</p>
<p>The driver starts to load the runtime by loading the shared library into the current
    (application's) address space and calls the Switchboard and Phonebook initialization.
Then, it calls the plugin loading for each ILLIXR plugin
    (except <a href="../../illixr_plugins/"><code>gldemo</code></a>, which is replaced by the OpenXR app).
Finally, it calls a special plugin loading which takes a function address instead of a file path
    to load a Translation Plugin into ILLIXR as the application.
If the plugin implements a long-running computation, it may block the main ILLIXR thread
    which drives the entire application.
To remedy this, a plugin should implement long-running processing in its own thread.
This way, the driver will be able to reacquire control and return to Monado
    and the application efficiently.</p>
<h2 id="translation-plugin">Translation Plugin</h2>
<p>When the application and all <a href="../../illixr_plugins/">ILLIXR plugins</a> are up and running,
    the translation plugin handles the connection between <a href="../../glossary/#monado"><em>Monado</em></a> and ILLIXR.
It might be confusing to see that this plugin is part of the ILLIXR driver which is part of
    Monado while at the same time also part of ILLIXR as a plugin.
However, Monado and ILLIXR are running in different threads in the same address space.
The translation plugin is the interface of these two parallel systems.</p>
<p>The translation plugin handles two types of events at the moment:
    <a href="../../glossary/#framebuffer"><em>pose</em></a> requests and <a href="../../glossary/#framebuffer"><em>frame</em></a> submissions.
From the view of Monado, the translation plugin is the destination of all requests:
    from the application,
    to Monado's state trackers,
    to the xdev interface who is responsible for servicing the request.
From the view of ILLIXR, the translation plugin behaves the same as the <a href="../../illixr_plugins/"><code>gldemo</code> application</a>:
    reading pose and submitting frames.</p>
<p>For implementation details regarding the representation of poses and frames in Monado
    and in ILLIXR, please see ILLIXR's <a href="../monado_integration_dataflow/">Monado Integration Dataflow</a>.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../README_gldemo/" class="btn btn-neutral float-left" title="Gldemo"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../monado_integration_dataflow/" class="btn btn-neutral float-right" title="Monado Dataflow">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../README_gldemo/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../monado_integration_dataflow/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../js/clipboard.min.js" defer></script>
      <script src="../../js/code-box-copy.js" defer></script>
      <script src="../../js/prism.min.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
